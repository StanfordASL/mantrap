
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <title>Environment &#8212; mantrap 0.1 documentation</title>
    <link rel="stylesheet" href="_static/pyramid.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Solver" href="solver.html" />
    <link rel="prev" title="Agents" href="agents.html" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Neuton&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Nobile:regular,italic,bold,bolditalic&amp;subset=latin" type="text/css" media="screen" charset="utf-8" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

  </head><body>

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="solver.html" title="Solver"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="agents.html" title="Agents"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">mantrap 0.1 documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="environment">
<h1>Environment<a class="headerlink" href="#environment" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-mantrap.environment.base.graph_based">
<span id="graph-based-environment-abstract"></span><h2>Graph-Based Environment (abstract)<a class="headerlink" href="#module-mantrap.environment.base.graph_based" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment">
<em class="property">class </em><code class="sig-prename descclassname">mantrap.environment.base.graph_based.</code><code class="sig-name descname">GraphBasedEnvironment</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ego_type</span><span class="p">:</span> <span class="n">abc.ABCMeta</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ego_position</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ego_velocity</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">tensor([0.0, 0.0])</span></em>, <em class="sig-param"><span class="n">ego_history</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">x_axis</span><span class="p">:</span> <span class="n">Tuple<span class="p">[</span>float<span class="p">, </span>float<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">- 10, 10</span></em>, <em class="sig-param"><span class="n">y_axis</span><span class="p">:</span> <span class="n">Tuple<span class="p">[</span>float<span class="p">, </span>float<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">- 10, 10</span></em>, <em class="sig-param"><span class="n">dt</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.4</span></em>, <em class="sig-param"><span class="n">time</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">config_name</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'unknown'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment" title="Permalink to this definition">¶</a></dt>
<dd><p>General environment engine for obstacle-free, interaction-aware, probabilistic and multi-modal agent
environments. As used in a robotics use-case the environment separates between the ego-agent (the robot) and
ado-agents (other agents in the scene which are not the robot).</p>
<p>The internal states basically are the states of the ego and ados and can only be changed by either using the
<cite>step()</cite> or <cite>step_reset()</cite> function, which simulate how the environment reacts based on some action performed by
the ego or resets it directly to some given states.</p>
<p>The simulated world is two-dimensional and defined in the area limited by the passed <cite>x_axis</cite> and <cite>y_axis</cite>. It has
a constant environment time-step <cite>dt</cite>.</p>
<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.add_ado">
<code class="sig-name descname">add_ado</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">position</span><span class="p">:</span> <span class="n">torch.Tensor</span></em>, <em class="sig-param"><span class="n">velocity</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">tensor([0.0, 0.0])</span></em>, <em class="sig-param"><span class="n">history</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">ado_kwargs</span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="agents.html#mantrap.agents.integrator_single.IntegratorDTAgent" title="mantrap.agents.integrator_single.IntegratorDTAgent">mantrap.agents.integrator_single.IntegratorDTAgent</a><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.add_ado" title="Permalink to this definition">¶</a></dt>
<dd><p>Add ado (i.e. non-robot) agent to environment as single integrator.</p>
<p>To represent pedestrians (ados) single integrator dynamics are best suitable due to their dynamic, reactive
and fast changing nature.</p>
<p>While the ego is added to the environment during initialization, the ado agents have to be added afterwards,
individually. To do so initialize single integrator agent using its state vectors, namely position, velocity
and its state history. The ado id, color and other parameters can either be passed using the ado_kwargs
option or are created automatically during the agent’s initialization.</p>
<p>After initialization check whether the given states are valid, i.e. do  not pass the internal environment
bounds, e.g. that they are in the given 2D space the environment is defined in.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>position</strong> – ado initial position (2D).</p></li>
<li><p><strong>velocity</strong> – ado initial velocity (2D).</p></li>
<li><p><strong>history</strong> – ado state history (if None then just current state as history).</p></li>
<li><p><strong>ado_kwargs</strong> – addition kwargs for ado initialization.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.check_distribution">
<code class="sig-name descname">check_distribution</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">distribution</span><span class="p">:</span> <span class="n">Dict<span class="p">[</span>str<span class="p">, </span>torch.distributions.distribution.Distribution<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">t_horizon</span><span class="p">:</span> <span class="n">int</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.check_distribution" title="Permalink to this definition">¶</a></dt>
<dd><p>Check the distribution dictionary for correctness.</p>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.compute_distributions">
<code class="sig-name descname">compute_distributions</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ego_trajectory</span><span class="p">:</span> <span class="n">torch.Tensor</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; Dict<span class="p">[</span>str<span class="p">, </span>torch.distributions.distribution.Distribution<span class="p">]</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.compute_distributions" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a dictionary of positional distributions for every ado as it would be with the presence
of a robot in the scene.</p>
<p>Build the graph conditioned on some <cite>ego_trajectory</cite>, which is assumed to be fix while the ados in the scene
behave accordingly, i.e. in reaction to the ego’s trajectory. For the sake of differentiability using the
by building the dictionary using PyTorch, a computational graph is built in the background which can later
be used for automatically differentiate between its inputs and outputs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ego_trajectory</strong> – ego’s trajectory (t_horizon, 5).</p>
</dd>
<dt class="field-even">Kwargs</dt>
<dd class="field-even"><p>additional graph building arguments.</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>dictionary over every state of every agent in the scene for t in [0, t_horizon].</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.compute_distributions_wo_ego">
<code class="sig-name descname">compute_distributions_wo_ego</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">t_horizon</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">kwargs</span></em><span class="sig-paren">)</span> &#x2192; Dict<span class="p">[</span>str<span class="p">, </span>torch.distributions.distribution.Distribution<span class="p">]</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.compute_distributions_wo_ego" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a dictionary of positional distributions for every ado as it would be without the presence
of a robot in the scene.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>t_horizon</strong> – number of prediction time-steps.</p>
</dd>
<dt class="field-even">Kwargs</dt>
<dd class="field-even"><p>additional graph building arguments.</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>ado_id-keyed positional distribution dictionary for times [0, t_horizon].</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.copy">
<code class="sig-name descname">copy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">env_type</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment" title="mantrap.environment.base.graph_based.GraphBasedEnvironment">mantrap.environment.base.graph_based.GraphBasedEnvironment</a><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.copy" title="Permalink to this definition">¶</a></dt>
<dd><p>Create copy of environment.</p>
<p>However just using deepcopy is not supported for tensors that are not detached from the PyTorch
computation graph. Therefore re-initialize the objects such as the agents in the environment and reset
their state to the internal current state.</p>
<p>While copying the environment-type can be defined by the user, which is possible due to standardized
class interface of every environment-type. When no environment is defined, the default environment
will be used which is the type of the executing class object.</p>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.detach">
<code class="sig-name descname">detach</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.detach" title="Permalink to this definition">¶</a></dt>
<dd><p>Detach all internal agents (ego and all ados) from computation graph. This is sometimes required to
completely separate subsequent computations in PyTorch.</p>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.predict_w_controls">
<code class="sig-name descname">predict_w_controls</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ego_controls</span><span class="p">:</span> <span class="n">torch.Tensor</span></em>, <em class="sig-param"><span class="n">expand</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>torch.Tensor<span class="p">]</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.predict_w_controls" title="Permalink to this definition">¶</a></dt>
<dd><p>Predict the ado path distribution means based conditioned on robot controls.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ego_controls</strong> – ego control input (pred_horizon, 2).</p></li>
<li><p><strong>expand</strong> – expand ado positions outputs to full state trajectories.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>predicted ado paths (num_ados, num_samples, pred_horizon+1, 2/5).
if no ado in scene, return None instead.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.predict_w_trajectory">
<code class="sig-name descname">predict_w_trajectory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ego_trajectory</span><span class="p">:</span> <span class="n">torch.Tensor</span></em>, <em class="sig-param"><span class="n">expand</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>torch.Tensor<span class="p">]</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.predict_w_trajectory" title="Permalink to this definition">¶</a></dt>
<dd><p>Predict the ado path samples based conditioned on robot trajectory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ego_trajectory</strong> – ego trajectory (pred_horizon + 1, 5).</p></li>
<li><p><strong>expand</strong> – expand ado positions outputs to full state trajectories.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>predicted ado paths (num_ados, num_samples, pred_horizon+1, 2/5).
if no ado in scene, return None instead.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.predict_wo_ego">
<code class="sig-name descname">predict_wo_ego</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">t_horizon</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">expand</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>torch.Tensor<span class="p">]</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.predict_wo_ego" title="Permalink to this definition">¶</a></dt>
<dd><p>Predict the unconditioned ado path distribution means (i.e. if no robot would be in the scene).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>t_horizon</strong> – prediction horizon, number of discrete time-steps.</p></li>
<li><p><strong>expand</strong> – expand ado positions outputs to full state trajectories.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>predicted ado paths (num_ados, num_samples, pred_horizon+1, 2/5).
if no ado in scene, return None instead.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.same_initial_conditions">
<code class="sig-name descname">same_initial_conditions</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">other</span><span class="p">:</span> <span class="n"><a class="reference internal" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment" title="mantrap.environment.base.graph_based.GraphBasedEnvironment">mantrap.environment.base.graph_based.GraphBasedEnvironment</a></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.same_initial_conditions" title="Permalink to this definition">¶</a></dt>
<dd><p>Similar to __eq__() function, but not enforcing parameters of environment to be completely equivalent,
merely enforcing the initial conditions to be equal, such as states of agents in scene. Hence, all prediction
depending parameters, dont have to be equal.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>other</strong> – comparable environment object.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.sample_w_controls">
<code class="sig-name descname">sample_w_controls</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ego_controls</span><span class="p">:</span> <span class="n">torch.Tensor</span></em>, <em class="sig-param"><span class="n">num_samples</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">1</span></em>, <em class="sig-param"><span class="n">expand</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>torch.Tensor<span class="p">]</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.sample_w_controls" title="Permalink to this definition">¶</a></dt>
<dd><p>Predict the ado path samples based conditioned on robot controls.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ego_controls</strong> – ego control input (pred_horizon, 2).</p></li>
<li><p><strong>num_samples</strong> – number of samples to return.</p></li>
<li><p><strong>expand</strong> – expand ado positions outputs to full state trajectories.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>predicted ado paths (num_ados, num_samples, pred_horizon+1, 2/5).
if no ado in scene, return None instead.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.sample_w_trajectory">
<code class="sig-name descname">sample_w_trajectory</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ego_trajectory</span><span class="p">:</span> <span class="n">torch.Tensor</span></em>, <em class="sig-param"><span class="n">num_samples</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">1</span></em>, <em class="sig-param"><span class="n">expand</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>torch.Tensor<span class="p">]</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.sample_w_trajectory" title="Permalink to this definition">¶</a></dt>
<dd><p>Predict the ado path samples based conditioned on robot trajectory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ego_trajectory</strong> – ego trajectory (pred_horizon + 1, 5).</p></li>
<li><p><strong>num_samples</strong> – number of samples to return.</p></li>
<li><p><strong>expand</strong> – expand ado positions outputs to full state trajectories.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>predicted ado paths (num_ados, num_samples, pred_horizon+1, 2/5).
if no ado in scene, return None instead.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.sample_wo_ego">
<code class="sig-name descname">sample_wo_ego</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">t_horizon</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">num_samples</span><span class="p">:</span> <span class="n">int</span> <span class="o">=</span> <span class="default_value">1</span></em>, <em class="sig-param"><span class="n">expand</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span> &#x2192; Optional<span class="p">[</span>torch.Tensor<span class="p">]</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.sample_wo_ego" title="Permalink to this definition">¶</a></dt>
<dd><p>Predict the unconditioned ado path samples (i.e. if no robot would be in the scene).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>t_horizon</strong> – prediction horizon, number of discrete time-steps.</p></li>
<li><p><strong>num_samples</strong> – number of samples to return.</p></li>
<li><p><strong>expand</strong> – expand ado positions outputs to full state trajectories.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>predicted ado paths (num_ados, num_samples, pred_horizon+1, 2/5).
if no ado in scene, return None instead.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.sanity_check">
<code class="sig-name descname">sanity_check</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">check_ego</span><span class="p">:</span> <span class="n">bool</span> <span class="o">=</span> <span class="default_value">False</span></em><span class="sig-paren">)</span> &#x2192; bool<a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.sanity_check" title="Permalink to this definition">¶</a></dt>
<dd><p>Check for the sanity of the scene and agents.</p>
<p>For the environment to be “sane” general environment properties should hold as well as all agents living
in the environment should be “sane” as well. For example it is ensured that the number and order of <cite>ado_ids</cite>
is equal to the list of <cite>ados</cite> itself.</p>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.states">
<code class="sig-name descname">states</code><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; Tuple<span class="p">[</span>torch.Tensor<span class="p">, </span>torch.Tensor<span class="p">]</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.states" title="Permalink to this definition">¶</a></dt>
<dd><p>Return current states of ego and ado agents in the scene. Since the current state is known for every
ado the states are deterministic and uni-modal. States are returned as vector including temporal dimension.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>ego state vector including temporal dimension (5).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>ado state vectors including temporal dimension (num_ados, 5).</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.step">
<code class="sig-name descname">step</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ego_action</span><span class="p">:</span> <span class="n">torch.Tensor</span></em><span class="sig-paren">)</span> &#x2192; Tuple<span class="p">[</span>torch.Tensor<span class="p">, </span>Optional<span class="p">[</span>torch.Tensor<span class="p">]</span><span class="p">]</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.step" title="Permalink to this definition">¶</a></dt>
<dd><p>Run environment step (time-step = dt).</p>
<p>Attention: This method changes the states of all environment agents, by executing the ego action
and sample from the conditioned ado positional distribution.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>ego_action</strong> – planned ego control input for current time step (2).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>ado_states (num_ados, num_modes, 1, 5), ego_next_state (5) in next time step.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.step_reset">
<code class="sig-name descname">step_reset</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ego_next</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>torch.Tensor<span class="p">]</span></span></em>, <em class="sig-param"><span class="n">ado_next</span><span class="p">:</span> <span class="n">Optional<span class="p">[</span>torch.Tensor<span class="p">]</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.step_reset" title="Permalink to this definition">¶</a></dt>
<dd><p>Run environment step (time-step = dt). Instead of predicting the behaviour of every agent in the scene, it
is given as an input and the agents are merely updated. All the ghosts (modes of an ado) will collapse to the
same given state, since the update is deterministic.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>ego_next</strong> – ego state for next time step (5).</p></li>
<li><p><strong>ado_next</strong> – ado states for next time step (num_ados, num_modes, 1, 5).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.visualize_prediction">
<code class="sig-name descname">visualize_prediction</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ego_trajectory</span><span class="p">:</span> <span class="n">torch.Tensor</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">vis_kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.visualize_prediction" title="Permalink to this definition">¶</a></dt>
<dd><p>Visualize the predictions for the scene based on the given ego trajectory.</p>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.graph_based.GraphBasedEnvironment.visualize_prediction_wo_ego">
<code class="sig-name descname">visualize_prediction_wo_ego</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">t_horizon</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">vis_kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mantrap.environment.base.graph_based.GraphBasedEnvironment.visualize_prediction_wo_ego" title="Permalink to this definition">¶</a></dt>
<dd><p>Visualize the predictions for the scene based on the given ego trajectory.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-mantrap.environment.base.particle">
<span id="particle-environments"></span><h2>Particle Environments<a class="headerlink" href="#module-mantrap.environment.base.particle" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt id="mantrap.environment.base.particle.ParticleEnvironment">
<em class="property">class </em><code class="sig-prename descclassname">mantrap.environment.base.particle.</code><code class="sig-name descname">ParticleEnvironment</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ego_type</span><span class="p">:</span> <span class="n">abc.ABCMeta</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ego_position</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ego_velocity</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">tensor([0.0, 0.0])</span></em>, <em class="sig-param"><span class="n">ego_history</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">x_axis</span><span class="p">:</span> <span class="n">Tuple<span class="p">[</span>float<span class="p">, </span>float<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">- 10, 10</span></em>, <em class="sig-param"><span class="n">y_axis</span><span class="p">:</span> <span class="n">Tuple<span class="p">[</span>float<span class="p">, </span>float<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">- 10, 10</span></em>, <em class="sig-param"><span class="n">dt</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.4</span></em>, <em class="sig-param"><span class="n">time</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">config_name</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'unknown'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mantrap.environment.base.particle.ParticleEnvironment" title="Permalink to this definition">¶</a></dt>
<dd><dl class="py method">
<dt id="mantrap.environment.base.particle.ParticleEnvironment.create_particles">
<em class="property">abstract </em><code class="sig-name descname">create_particles</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">num_particles</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">param_dicts</span><span class="p">:</span> <span class="n">Dict<span class="p">[</span>str<span class="p">, </span>Dict<span class="p">[</span>str<span class="p">, </span>Dict<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">const_dicts</span><span class="p">:</span> <span class="n">Dict<span class="p">[</span>str<span class="p">, </span>Dict<span class="p">[</span>str<span class="p">, </span>Any<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">particle_kwargs</span></em><span class="sig-paren">)</span> &#x2192; Tuple<span class="p">[</span>List<span class="p">[</span>List<span class="p">[</span><a class="reference internal" href="agents.html#mantrap.agents.integrator_single.IntegratorDTAgent" title="mantrap.agents.integrator_single.IntegratorDTAgent">mantrap.agents.integrator_single.IntegratorDTAgent</a><span class="p">]</span><span class="p">]</span><span class="p">, </span>torch.Tensor<span class="p">]</span><a class="headerlink" href="#mantrap.environment.base.particle.ParticleEnvironment.create_particles" title="Permalink to this definition">¶</a></dt>
<dd><p>Create particles from internal parameter distribution.</p>
<p>In order to create parameters sample from the underlying parameter distributions, which are modelled
as independent, uni-modal Gaussian distributions, individual for each ado. So build the distribution,
sample N = num_particles values for each ado and parameter and create N copies of each ado (particle)
storing the sampled parameter.</p>
<p>Attention: Not the same convention over all input parameters !</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num_particles</strong> – number of particles per ado.</p></li>
<li><p><strong>param_dicts</strong> – parameter dictionaries for varying parameters between particles.
{param_name: {ado_id: (mean, variance)}, ….}</p></li>
<li><p><strong>const_dicts</strong> – dictionary mapping ado-wise constant parameters to parameter name.
{ado_id: {param_name: values}, ….}</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list of N = num_particles for every ado in the scene.</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>probability (pdf) of each particle (num_ados, num_particles).</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.base.particle.ParticleEnvironment.simulate_particle">
<em class="property">abstract </em><code class="sig-name descname">simulate_particle</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">particle</span><span class="p">:</span> <span class="n"><a class="reference internal" href="agents.html#mantrap.agents.integrator_single.IntegratorDTAgent" title="mantrap.agents.integrator_single.IntegratorDTAgent">mantrap.agents.integrator_single.IntegratorDTAgent</a></span></em>, <em class="sig-param"><span class="n">means_t</span><span class="p">:</span> <span class="n">torch.Tensor</span></em>, <em class="sig-param"><span class="n">ego_state_t</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="agents.html#mantrap.agents.integrator_single.IntegratorDTAgent" title="mantrap.agents.integrator_single.IntegratorDTAgent">mantrap.agents.integrator_single.IntegratorDTAgent</a><a class="headerlink" href="#mantrap.environment.base.particle.ParticleEnvironment.simulate_particle" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward simulate particle for one time-step (t -&gt; t + 1).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>particle</strong> – particle agent to simulate.</p></li>
<li><p><strong>means_t</strong> – means of positional and velocity distribution at time t (num_ados, 4).</p></li>
<li><p><strong>ego_state_t</strong> – ego/robot state at time t.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<div class="section" id="module-mantrap.environment.social_forces">
<span id="social-forces"></span><h3>Social Forces<a class="headerlink" href="#module-mantrap.environment.social_forces" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt id="mantrap.environment.social_forces.SocialForcesEnvironment">
<em class="property">class </em><code class="sig-prename descclassname">mantrap.environment.social_forces.</code><code class="sig-name descname">SocialForcesEnvironment</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ego_type</span><span class="p">:</span> <span class="n">abc.ABCMeta</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ego_position</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ego_velocity</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">tensor([0.0, 0.0])</span></em>, <em class="sig-param"><span class="n">ego_history</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">x_axis</span><span class="p">:</span> <span class="n">Tuple<span class="p">[</span>float<span class="p">, </span>float<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">- 10, 10</span></em>, <em class="sig-param"><span class="n">y_axis</span><span class="p">:</span> <span class="n">Tuple<span class="p">[</span>float<span class="p">, </span>float<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">- 10, 10</span></em>, <em class="sig-param"><span class="n">dt</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.4</span></em>, <em class="sig-param"><span class="n">time</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">config_name</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'unknown'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mantrap.environment.social_forces.SocialForcesEnvironment" title="Permalink to this definition">¶</a></dt>
<dd><p>Social Forces Simulation.</p>
<p>Pedestrian Dynamics based on to “Social Force Model for Pedestrian Dynamics” (D. Helbling, P. Molnar). The idea
of Social Forces is to determine interaction forces by taking into account the following entities:</p>
<p><em>Goal force</em>:
Each ado has a specific goal state/position in mind, to which it moves to. The goal pulling force
is modelled as correction term between the direction vector of the current velocity and the goal direction
(vector between current position and goal).</p>
<div class="math notranslate nohighlight">
\[F_{goal} = 1 / tau_{a} (v_a^0 e_a - v_a)\]</div>
<p><em>Interaction force</em>:
For modelling interaction between multiple agents such as avoiding collisions each agent
has an with increasing distance exponentially decaying repulsion field. Together with the scalar product of the
velocity of each agent pair (in order to not alter close but non interfering agents, e.g. moving parallel to
each other) the interaction term is constructed.</p>
<div class="math notranslate nohighlight">
\[V_{aB} (x) = V0_a exp(−x / \sigma_a)\]</div>
<div class="math notranslate nohighlight">
\[F_{interaction} = - grad_{r_{ab}} V_{aB}(||r_{ab}||)\]</div>
<p>Although theoretically  a force introduces an acceleration as the ado’s control input (double not single
integrator dynamics), accelerations are simplified to act as velocities, which is reasonable due to the fast
reaction time of the pedestrian, which is way faster than the environment sampling rate.</p>
<dl class="py method">
<dt id="mantrap.environment.social_forces.SocialForcesEnvironment.add_ado">
<code class="sig-name descname">add_ado</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">position</span><span class="p">:</span> <span class="n">torch.Tensor</span></em>, <em class="sig-param"><span class="n">velocity</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">tensor([0.0, 0.0])</span></em>, <em class="sig-param"><span class="n">history</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">goal</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">tensor([0.0, 0.0])</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">ado_kwargs</span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="agents.html#mantrap.agents.integrator_single.IntegratorDTAgent" title="mantrap.agents.integrator_single.IntegratorDTAgent">mantrap.agents.integrator_single.IntegratorDTAgent</a><a class="headerlink" href="#mantrap.environment.social_forces.SocialForcesEnvironment.add_ado" title="Permalink to this definition">¶</a></dt>
<dd><p>Add ado (i.e. non-robot) agent to environment as single integrator.</p>
<p>While the ego is added to the environment during initialization, the ado agents have to be added afterwards,
individually. To do so initialize single integrator agent using its state vectors, namely position, velocity
and its state history. The ado id, color and other parameters can either be passed using the ado_kwargs
option or are created automatically during the agent’s initialization.</p>
<p>After initialization check whether the given states are valid, i.e. do  not pass the internal environment
bounds, e.g. that they are in the given 2D space the environment is defined in.</p>
<p>Simply add a goal state to the ado definition as required by social forces model</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>position</strong> – ado initial position (2D).</p></li>
<li><p><strong>velocity</strong> – ado initial velocity (2D).</p></li>
<li><p><strong>history</strong> – ado state history (if None then just stacked current state).</p></li>
<li><p><strong>goal</strong> – ado goal position (2D).</p></li>
<li><p><strong>ado_kwargs</strong> – addition kwargs for ado initialization.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.social_forces.SocialForcesEnvironment.create_particles">
<code class="sig-name descname">create_particles</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">num_particles</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">v0_dict</span><span class="p">:</span> <span class="n">Dict<span class="p">[</span>str<span class="p">, </span>Tuple<span class="p">[</span>float<span class="p">, </span>float<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">sigma_dict</span><span class="p">:</span> <span class="n">Dict<span class="p">[</span>str<span class="p">, </span>Tuple<span class="p">[</span>float<span class="p">, </span>float<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">tau</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.4</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">unused</span></em><span class="sig-paren">)</span> &#x2192; Tuple<span class="p">[</span>List<span class="p">[</span>List<span class="p">[</span><a class="reference internal" href="agents.html#mantrap.agents.integrator_single.IntegratorDTAgent" title="mantrap.agents.integrator_single.IntegratorDTAgent">mantrap.agents.integrator_single.IntegratorDTAgent</a><span class="p">]</span><span class="p">]</span><span class="p">, </span>torch.Tensor<span class="p">]</span><a class="headerlink" href="#mantrap.environment.social_forces.SocialForcesEnvironment.create_particles" title="Permalink to this definition">¶</a></dt>
<dd><p>Create particles from internal parameter distribution.</p>
<p>In order to create parameters sample from the underlying parameter distributions, which are modelled
as independent, uni-modal Gaussian distributions, individual for each ado. So build the distribution,
sample N = num_particles values for each ado and parameter and create N copies of each ado (particle)
storing the sampled parameter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num_particles</strong> – number of particles per ado.</p></li>
<li><p><strong>v0_dict</strong> – parameter v0 gaussian distribution (mean, variance) by ado_id, if None then gaussian
with mean = <cite>mantrap.constants.SOCIAL_FORCES_DEFAULT_V0</cite> and variance = mean/4,
similarly for each ado.</p></li>
<li><p><strong>sigma_dict</strong> – parameter sigma gaussian distribution (similar to <cite>v0_dict</cite>).</p></li>
<li><p><strong>tau</strong> – tau parameter, by default <cite>mantrap.constants.SOCIAL_FORCES_DEFAULT_TAU</cite>,
which has to be shared over all agents.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list of N = num_particles for every ado in the scene.</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>probability (pdf) of each particle (num_ados, num_particles).</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.social_forces.SocialForcesEnvironment.simulate_particle">
<code class="sig-name descname">simulate_particle</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">particle</span><span class="p">:</span> <span class="n"><a class="reference internal" href="agents.html#mantrap.agents.integrator_single.IntegratorDTAgent" title="mantrap.agents.integrator_single.IntegratorDTAgent">mantrap.agents.integrator_single.IntegratorDTAgent</a></span></em>, <em class="sig-param"><span class="n">means_t</span><span class="p">:</span> <span class="n">torch.Tensor</span></em>, <em class="sig-param"><span class="n">ego_state_t</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="agents.html#mantrap.agents.integrator_single.IntegratorDTAgent" title="mantrap.agents.integrator_single.IntegratorDTAgent">mantrap.agents.integrator_single.IntegratorDTAgent</a><a class="headerlink" href="#mantrap.environment.social_forces.SocialForcesEnvironment.simulate_particle" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward simulate particle for one time-step (t -&gt; t + 1).</p>
<p>Use the social forces equations writen in the class description for updating the particles. Thereby take
into account repulsive forces from both the robot and other ados as well as a pulling force between
the particle and its “goal” state.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>particle</strong> – particle agent to simulate.</p></li>
<li><p><strong>means_t</strong> – means of positional and velocity distribution at time t (num_ados, 4).</p></li>
<li><p><strong>ego_state_t</strong> – ego/robot state at time t.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-mantrap.environment.simplified.potential_field">
<span id="potential-field"></span><h3>Potential Field<a class="headerlink" href="#module-mantrap.environment.simplified.potential_field" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt id="mantrap.environment.simplified.potential_field.PotentialFieldEnvironment">
<em class="property">class </em><code class="sig-prename descclassname">mantrap.environment.simplified.potential_field.</code><code class="sig-name descname">PotentialFieldEnvironment</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ego_type</span><span class="p">:</span> <span class="n">abc.ABCMeta</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ego_position</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ego_velocity</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">tensor([0.0, 0.0])</span></em>, <em class="sig-param"><span class="n">ego_history</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">x_axis</span><span class="p">:</span> <span class="n">Tuple<span class="p">[</span>float<span class="p">, </span>float<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">- 10, 10</span></em>, <em class="sig-param"><span class="n">y_axis</span><span class="p">:</span> <span class="n">Tuple<span class="p">[</span>float<span class="p">, </span>float<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">- 10, 10</span></em>, <em class="sig-param"><span class="n">dt</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.4</span></em>, <em class="sig-param"><span class="n">time</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">config_name</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'unknown'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mantrap.environment.simplified.potential_field.PotentialFieldEnvironment" title="Permalink to this definition">¶</a></dt>
<dd><p>Simplified version of social forces environment class.</p>
<p>The simplified model assumes static agents (ados) in the scene, having zero velocity (if not stated otherwise)
and staying in this (non)-movement since no forces are applied. Hereby, the graph model is cut to the pure
interaction between ego and ado, no inter-ado interaction and goal pulling force. Since the ados would not move
at all without an ego agent in the scene, the interaction loss simply comes down the the distance of every position
of the ados in time to their initial (static) position.</p>
<p>Although theoretically  a force introduces an acceleration as the ado’s control input (double not single
integrator dynamics), accelerations are simplified to act as velocities, which is reasonable due to the fast
reaction time of the pedestrian, which is way faster than the environment sampling rate.</p>
<dl class="py method">
<dt id="mantrap.environment.simplified.potential_field.PotentialFieldEnvironment.create_particles">
<code class="sig-name descname">create_particles</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">num_particles</span><span class="p">:</span> <span class="n">int</span></em>, <em class="sig-param"><span class="n">v0_dict</span><span class="p">:</span> <span class="n">Dict<span class="p">[</span>str<span class="p">, </span>Tuple<span class="p">[</span>float<span class="p">, </span>float<span class="p">]</span><span class="p">]</span></span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; Tuple<span class="p">[</span>List<span class="p">[</span>List<span class="p">[</span><a class="reference internal" href="agents.html#mantrap.agents.integrator_single.IntegratorDTAgent" title="mantrap.agents.integrator_single.IntegratorDTAgent">mantrap.agents.integrator_single.IntegratorDTAgent</a><span class="p">]</span><span class="p">]</span><span class="p">, </span>torch.Tensor<span class="p">]</span><a class="headerlink" href="#mantrap.environment.simplified.potential_field.PotentialFieldEnvironment.create_particles" title="Permalink to this definition">¶</a></dt>
<dd><p>Create particles from internal parameter distribution.</p>
<p>In order to create parameters sample from the underlying parameter distributions, which are modelled
as independent, uni-modal Gaussian distributions, individual for each ado. So build the distribution,
sample N = num_particles values for each ado and parameter and create N copies of each ado (particle)
storing the sampled parameter.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>num_particles</strong> – number of particles per ado.</p></li>
<li><p><strong>v0_dict</strong> – parameter v0 gaussian distribution (mean, variance) by ado_id, if None then gaussian
with mean = <cite>mantrap.constants.POTENTIAL_FIELD_V0_DEFAULT</cite> and variance = mean/4,
similarly for each ado.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>list of N = num_particles for every ado in the scene.</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>probability (pdf) of each particle (num_ados, num_particles).</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.simplified.potential_field.PotentialFieldEnvironment.simulate_particle">
<code class="sig-name descname">simulate_particle</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">particle</span><span class="p">:</span> <span class="n"><a class="reference internal" href="agents.html#mantrap.agents.integrator_single.IntegratorDTAgent" title="mantrap.agents.integrator_single.IntegratorDTAgent">mantrap.agents.integrator_single.IntegratorDTAgent</a></span></em>, <em class="sig-param"><span class="n">means_t</span><span class="p">:</span> <span class="n">torch.Tensor</span></em>, <em class="sig-param"><span class="n">ego_state_t</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="agents.html#mantrap.agents.integrator_single.IntegratorDTAgent" title="mantrap.agents.integrator_single.IntegratorDTAgent">mantrap.agents.integrator_single.IntegratorDTAgent</a><a class="headerlink" href="#mantrap.environment.simplified.potential_field.PotentialFieldEnvironment.simulate_particle" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward simulate particle for one time-step (t -&gt; t + 1).</p>
<p>As described in the class description the potential field environment merely takes into account the
repulsive force with respect to the ego, not to other ados, and introduces it as direct control input
for the particle.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>particle</strong> – particle agent to simulate.</p></li>
<li><p><strong>means_t</strong> – means of positional and velocity distribution at time t (num_ados, 4).</p></li>
<li><p><strong>ego_state_t</strong> – ego/robot state at time t.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-mantrap.environment.simplified.kalman">
<span id="kalman"></span><h3>Kalman<a class="headerlink" href="#module-mantrap.environment.simplified.kalman" title="Permalink to this headline">¶</a></h3>
<dl class="py class">
<dt id="mantrap.environment.simplified.kalman.KalmanEnvironment">
<em class="property">class </em><code class="sig-prename descclassname">mantrap.environment.simplified.kalman.</code><code class="sig-name descname">KalmanEnvironment</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ego_type</span><span class="p">:</span> <span class="n">abc.ABCMeta</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ego_position</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ego_velocity</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">tensor([0.0, 0.0])</span></em>, <em class="sig-param"><span class="n">ego_history</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">x_axis</span><span class="p">:</span> <span class="n">Tuple<span class="p">[</span>float<span class="p">, </span>float<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">- 10, 10</span></em>, <em class="sig-param"><span class="n">y_axis</span><span class="p">:</span> <span class="n">Tuple<span class="p">[</span>float<span class="p">, </span>float<span class="p">]</span></span> <span class="o">=</span> <span class="default_value">- 10, 10</span></em>, <em class="sig-param"><span class="n">dt</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.4</span></em>, <em class="sig-param"><span class="n">time</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.0</span></em>, <em class="sig-param"><span class="n">config_name</span><span class="p">:</span> <span class="n">str</span> <span class="o">=</span> <span class="default_value">'unknown'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mantrap.environment.simplified.kalman.KalmanEnvironment" title="Permalink to this definition">¶</a></dt>
<dd><p>Kalman (Filter) - based Environment.</p>
<p>The Kalman environment implements the update rules, defined in the Kalman Filter, to update the agents
states iteratively. Thereby no interactions between the agents are taken into account. The growing
uncertainty in the prediction, growing with the number of predicted time-steps, is modelled as a
variance increasing with constant rate, which in the Kalman Equations is a constant noise Q_k. Assuming
constant state space matrices (F, B) we get:</p>
<p>with z_k = H x_k (H = H_k = eye(N)) the observations, I = eye(n) the identity matrix and R = 0 (perfect
perception assumption). In the notation used in <cite>mantrap.agents</cite> the state space matrix A is used instead of
F, but they are equivalent.</p>
<p>Since no interactions are assumed to ados control inputs (i.e. velocities) are assumed to stay constant over
the full prediction horizon).</p>
</dd></dl>

</div>
</div>
<div class="section" id="trajectron">
<h2>Trajectron<a class="headerlink" href="#trajectron" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><span class="target" id="module-mantrap.environment.trajectron"></span><dl class="py class">
<dt id="mantrap.environment.trajectron.Trajectron">
<em class="property">class </em><code class="sig-prename descclassname">mantrap.environment.trajectron.</code><code class="sig-name descname">Trajectron</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ego_type</span><span class="p">:</span> <span class="n">abc.ABCMeta</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ego_position</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">ego_velocity</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">tensor([0.0, 0.0])</span></em>, <em class="sig-param"><span class="n">ego_history</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="n">dt</span><span class="p">:</span> <span class="n">float</span> <span class="o">=</span> <span class="default_value">0.4</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">env_kwargs</span></em><span class="sig-paren">)</span><a class="headerlink" href="#mantrap.environment.trajectron.Trajectron" title="Permalink to this definition">¶</a></dt>
<dd><p>Trajectron-based environment model (B. Ivanovic, T. Salzmann, M. Pavone).</p>
<p>The Trajectron model requires to get some robot position. Therefore, in order to minimize the
impact of the ego robot on the trajectories (since the prediction should be not conditioned on the robot)
some pseudo trajectory is used, which is very far distant from the actual scene.</p>
<p>Within the trajectory optimisation the ado’s trajectories conditioned on the robot’s planned motion are
compared with their trajectories without taking any robot into account. So when both the conditioned and
un-conditioned model for these predictions would be used, and they would be behavioral different, it would
lead to some base difference (even if there is no robot affecting some ado at all) which might be larger in
scale than the difference the conditioning on the robot makes. Then minimizing the difference would miss the
goal of minimizing interaction.</p>
<dl class="py method">
<dt id="mantrap.environment.trajectron.Trajectron.add_ado">
<code class="sig-name descname">add_ado</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">position</span><span class="p">:</span> <span class="n">torch.Tensor</span></em>, <em class="sig-param"><span class="n">velocity</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">tensor([0.0, 0.0])</span></em>, <em class="sig-param"><span class="n">history</span><span class="p">:</span> <span class="n">torch.Tensor</span> <span class="o">=</span> <span class="default_value">None</span></em>, <em class="sig-param"><span class="o">**</span><span class="n">ado_kwargs</span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="agents.html#mantrap.agents.integrator_single.IntegratorDTAgent" title="mantrap.agents.integrator_single.IntegratorDTAgent">mantrap.agents.integrator_single.IntegratorDTAgent</a><a class="headerlink" href="#mantrap.environment.trajectron.Trajectron.add_ado" title="Permalink to this definition">¶</a></dt>
<dd><p>Add ado (i.e. non-robot) agent to environment as single integrator.</p>
<p>While the ego is added to the environment during initialization, the ado agents have to be added afterwards,
individually. To do so initialize single integrator agent using its state vectors, namely position, velocity
and its state history. The ado id, color and other parameters can either be passed using the ado_kwargs
option or are created automatically during the agent’s initialization.</p>
<p>After initialization check whether the given states are valid, i.e. do  not pass the internal environment
bounds, e.g. that they are in the given 2D space the environment is defined in.</p>
<p>Next to the internal ado representation of each ado within this class, the Trajectron model has an own
graph, in which the ado has to be introduced as a node during initialization. Also Trajectron model is
trained to predict accurately, iff the agent has some history &gt; 1, therefore if no history is given
build a custom history by stacking the given (position, velocity) state over multiple time-steps. If
zero history should be enforced, pass a non None history argument.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>position</strong> – ado initial position (2D).</p></li>
<li><p><strong>velocity</strong> – ado initial velocity (2D).</p></li>
<li><p><strong>history</strong> – ado state history (if None then just stacked current state).</p></li>
<li><p><strong>ado_kwargs</strong> – addition kwargs for ado initialization.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.trajectron.Trajectron.agent_id_from_node">
<em class="property">static </em><code class="sig-name descname">agent_id_from_node</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">node</span><span class="p">:</span> <span class="n">str</span></em><span class="sig-paren">)</span> &#x2192; str<a class="headerlink" href="#mantrap.environment.trajectron.Trajectron.agent_id_from_node" title="Permalink to this definition">¶</a></dt>
<dd><p>In Trajectron nodes have an identifier structure as follows “node_type/node_id”. As initialized the node_id
is identical to the internal node_id while is node type is e.g. “ROBOT” or “PEDESTRIAN”. However it is not
assumed that the node_type has to be robot or pedestrian, since it does not change the structure.</p>
</dd></dl>

<dl class="py method">
<dt id="mantrap.environment.trajectron.Trajectron.detach">
<code class="sig-name descname">detach</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#mantrap.environment.trajectron.Trajectron.detach" title="Permalink to this definition">¶</a></dt>
<dd><p>Detaching the whole graph (which is the whole neural network) might be hard. Therefore just rebuilt it
from scratch completely, using the most up-to-date states of the agents.</p>
</dd></dl>

</dd></dl>

</div></blockquote>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Environment</a><ul>
<li><a class="reference internal" href="#module-mantrap.environment.base.graph_based">Graph-Based Environment (abstract)</a></li>
<li><a class="reference internal" href="#module-mantrap.environment.base.particle">Particle Environments</a><ul>
<li><a class="reference internal" href="#module-mantrap.environment.social_forces">Social Forces</a></li>
<li><a class="reference internal" href="#module-mantrap.environment.simplified.potential_field">Potential Field</a></li>
<li><a class="reference internal" href="#module-mantrap.environment.simplified.kalman">Kalman</a></li>
</ul>
</li>
<li><a class="reference internal" href="#trajectron">Trajectron</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="agents.html"
                        title="previous chapter">Agents</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="solver.html"
                        title="next chapter">Solver</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/environment.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="solver.html" title="Solver"
             >next</a> |</li>
        <li class="right" >
          <a href="agents.html" title="Agents"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">mantrap 0.1 documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, Simon Schaefer.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.0.4.
    </div>
  </body>
</html>